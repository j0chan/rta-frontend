<div class="search-bar">
  <app-search-bar (searchEvent)="onSearch($event)" (clearEvent)="onClearSearch()"></app-search-bar>
</div>

<!-- ì‚¬ìš©ì ë‚ ì”¨ ì…ë ¥ì°½ -->
<div class="weather-input-wrapper">
  <input [(ngModel)]="userWeather" placeholder="ì˜¤ëŠ˜ ë‚ ì”¨ëŠ” ì–´ë–¤ê°€ìš”? " />
  <button (click)="generateKeywordRecommendations()">ì¶”ì²œë°›ê¸°</button>
</div>

<!-- ê²€ìƒ‰/ì¶”ì²œ ê²°ê³¼ ì „ì²´ ë¬¶ìŒ -->
<div *ngIf="searchQuery || selectedKeyword || recommendedKeywords.length > 0">

  <!-- ë‹«íŒ ìƒíƒœì¼ ë•Œ: ë‹¤ì‹œ ë³´ê¸° ë²„íŠ¼ -->
  <div *ngIf="!isResultVisible" class="result-toggle-btn">
    <button (click)="isResultVisible = true">ğŸ” ê²°ê³¼ ë‹¤ì‹œ ë³´ê¸°</button>
  </div>

  <!-- ì—´ë¦° ìƒíƒœì¼ ë•Œ -->
  <div *ngIf="isResultVisible">

    <!-- ì¶”ì²œ í‚¤ì›Œë“œ ë²„íŠ¼ ë¦¬ìŠ¤íŠ¸ -->
    <div *ngIf="recommendedKeywords.length > 0" class="keyword-chips">
      <p>ì¶”ì²œ í‚¤ì›Œë“œ</p>
      <div class="chip-list">
        <button
          *ngFor="let keyword of recommendedKeywords"
          class="chip"
          [class.active]="selectedKeyword === keyword"
          (click)="onClickKeyword(keyword)">
          {{ keyword }}
        </button>
      </div>
    </div>

    <!-- íƒ­ ë²„íŠ¼ -->
    <div class="result-tabs">
      <button
        class="tab-btn"
        [class.active]="tabMode === 'search'"
        [disabled]="!searchQuery"
        (click)="handleSearchTabClick()">
        ê²€ìƒ‰ ê²°ê³¼
      </button>
      <button
        class="tab-btn"
        [class.active]="tabMode === 'recommend'"
        [disabled]="!selectedKeyword"
        (click)="tabMode = 'recommend'">
        ì¶”ì²œ ê²°ê³¼
      </button>
      <button class="tab-close" (click)="isResultVisible = false">âœ– ë‹«ê¸°</button>
    </div>

    <!-- ê²€ìƒ‰ ê²°ê³¼ íƒ­ -->
    <div *ngIf="tabMode === 'search' && filteredStores.length > 0" class="search-result-list">
      <ul class="store-list">
        <li *ngFor="let store of filteredStores" class="store-item db" (click)="focusStoreOnMap(store)">
          <div class="store-name" data-badge="DB">{{ store.store_name }}</div>
          <div class="store-address">{{ store.address }}</div>
        </li>
      </ul>
    </div>

    <!-- ì¶”ì²œ í‚¤ì›Œë“œ íƒ­ -->
    <div *ngIf="tabMode === 'recommend' && (matchedStores.length > 0 || externalPlaces.length > 0)" class="search-result-list">
      <ul class="store-list">
        <li *ngFor="let store of matchedStores" class="store-item db" (click)="focusStoreOnMap(store)">
          <div class="store-name" data-badge="DB">{{ store.store_name }}</div>
          <div class="store-address">{{ store.address }}</div>
        </li>
        <li *ngFor="let place of externalPlaces" class="store-item external" (click)="focusExternalPlaceOnMap(place)">
          <div class="store-name" data-badge="ì™¸ë¶€">{{ place.title | stripHtml }}</div>
          <div class="store-address">{{ place.address }}</div>
        </li>
      </ul>
    </div>
  </div>
</div>

<!-- ì§€ë„ -->
<div id="map" class="map-container"></div>

<!-- í˜„ìœ„ì¹˜ ì¬ê²€ìƒ‰ ë²„íŠ¼ -->
<button class="location-refresh-btn" (click)="refreshCurrentLocation()"></button>

<!-- ì¢Œí‘œ ê³ ì • í† ê¸€ ë²„íŠ¼ -->
<button class="location-toggle-btn" (click)="toggleFixedLocation()">
  {{ isFixedLocation ? 'ê°œë°œOn' : 'ê°œë°œOff' }}
</button>