<header class="app-header">
    <app-header-bar></app-header-bar>
    <app-divider></app-divider>
</header>

<main class="app-main">
    <app-container>
        <div class="page-wrap">
            <!-- 여민전 잔액 카드 -->
            <section class="section">
                <!-- button 중첩 방지: 바깥은 role="button" -->
                <div class="balance-card" role="button" tabindex="0" (click)="goTransactionPage()"
                    (keydown.enter)="goTransactionPage()" (keydown.space)="goTransactionPage()">

                    <div class="balance-top">
                        <span class="brand">여민전</span>
                    </div>

                    <div class="balance-row">
                        <span class="title">보유 금액</span>
                        <span class="amount">
                            <ng-container *ngIf="!(loading$ | async); else loadingTpl">
                                {{ formatKRW(balance$ | async) }}
                            </ng-container>
                        </span>
                    </div>

                    <div class="balance-bottom">
                        <span class="balance-helper">탭하여 상세보기</span>
                    </div>

                    <!-- 우측 하단: 회색 원형 새로고침 -->
                    <button type="button" class="refresh-fab" (click)="$event.stopPropagation(); fetchBalance()"
                        aria-label="새로고침">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" aria-hidden="true">
                            <path fill-rule="evenodd"
                                d="M8 3a5 5 0 1 0 4.546 2.914.5.5 0 0 1 .908-.417A6 6 0 1 1 8 2z" />
                            <path
                                d="M8 4.466V.534a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384L8.41 4.658A.25.25 0 0 1 8 4.466" />
                        </svg>
                    </button>
                </div>

                <!-- 충전/인출 -->
                <div class="money-actions" aria-label="여민전 자금 액션">
                    <button class="ma-btn primary" type="button" (click)="goDepositPage()">충전하기</button>
                    <button class="ma-btn ghost" type="button" (click)="goWithdrawPage()">인출하기</button>
                </div>
            </section>

            <!-- 하단 바로가기 4개 -->
            <nav class="quick-actions">
                <button class="qa-item" type="button" (click)="goTo('/gift-card-store')">
                    <img src="assets/icon/giftcard.png" alt="상품권 구매" class="qa-icon" />
                    <div class="qa-text">상품권 구매</div>
                </button>

                <button class="qa-item" type="button" (click)="goTo('/my-gift-card')">
                    <img src="assets/icon/mygift.png" alt="내 상품권" class="qa-icon" />
                    <div class="qa-text">내 상품권</div>
                </button>

                <button class="qa-item" type="button" (click)="goTo('/home')">
                    <img src="assets/icon/store.png" alt="가맹점 찾기" class="qa-icon" />
                    <div class="qa-text">가맹점 찾기</div>
                </button>

                <button class="qa-item" type="button" (click)="goTo('/point')">
                    <img src="assets/icon/point.png" alt="포인트" class="qa-icon" />
                    <div class="qa-text">포인트</div>
                </button>
            </nav>

            <!-- 프로모션 캐러셀 -->
            <section class="section promo-section" *ngIf="promos.length">
                <div class="section-head">
                    <h2>프로모션</h2>
                </div>

                <div class="promo-touch" (pointerdown)="onPromoPointerDown($event)"
                    (pointerup)="onPromoPointerUp($event)" (pointercancel)="onPromoPointerCancel()"
                    (touchstart)="onPromoTouchStart($event)" (touchend)="onPromoTouchEnd($event)"
                    (mousedown)="onPromoMouseDown($event)" (mouseup)="onPromoMouseUp($event)"
                    (mouseleave)="onPromoMouseLeave()" (contextmenu)="$event.preventDefault()">
                    <app-promo-banner [promotion]="promos[promoIndex]" [index]="promoIndex" [total]="promos.length"
                        [emphasize]="promoEmph" (clicked)="onPromoClick()">
                    </app-promo-banner>
                </div>

            </section>

            <!-- 공지사항(새소식) -->
            <section class="section notice-section">
                <div class="section-head">
                    <h2 (click)="goTo('/notice')">새소식</h2>
                </div>
                <app-home-notice-list></app-home-notice-list>
            </section>
        </div>
    </app-container>

    <!-- 로딩 템플릿 -->
    <ng-template #loadingTpl>
        <div class="skeleton-amount"></div>
    </ng-template>
</main>