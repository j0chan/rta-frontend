<ion-header [translucent]="false">
  <app-header-bar></app-header-bar>
</ion-header>

<ion-content [fullscreen]="false" class="page">

  <div class="container">

    <!-- 보기 모드 전환 -->
    <ion-segment [(ngModel)]="viewMode" class="view-toggle" mode="md">
      <ion-segment-button value="list">목록 보기</ion-segment-button>
      <ion-segment-button value="map">지도 보기</ion-segment-button>
    </ion-segment>

    <!-- 검색 -->
    <ion-searchbar
      *ngIf="viewMode === 'list'"
      class="searchbar"
      placeholder="가게 이름 검색"
      [(ngModel)]="searchTerm">
    </ion-searchbar>

    <!-- 즐겨찾기 목록 -->
    <ng-container *ngIf="viewMode === 'list'">
      <ion-grid class="fav-grid">
        <ion-row>
          <ion-col size="12" *ngFor="let fav of filteredFavorites">
            <ion-card class="fav-card">
              <ion-card-header class="fav-card__header">
                <ion-card-title class="fav-card__title">
                  {{ fav?.store_name || '이름 없음' }}
                </ion-card-title>
                <ion-icon name="heart" color="danger" class="fav-card__heart"></ion-icon>
              </ion-card-header>

              <ion-card-content class="fav-card__content">
                <div class="info-row">
                  <span class="info-label">주소</span>
                  <span class="info-text">{{ fav?.address || '주소 정보 없음' }}</span>
                </div>

                <div class="info-row">
                  <span class="info-label">전화번호</span>
                  <span class="info-text">{{ fav?.contact_number || '전화번호 없음' }}</span>
                </div>

                <div class="btn-group">
                  <ion-button
                    expand="block"
                    class="btn-primary"
                    (click)="focusStoreOnMap(fav.store_id); switchToMap(); $event.stopPropagation();">
                    지도에서 보기
                  </ion-button>

                  <ion-button
                    expand="block"
                    class="btn-secondary"
                    (click)="removeFavorite(fav.store_id); $event.stopPropagation();">
                    삭제
                  </ion-button>
                </div>
              </ion-card-content>
            </ion-card>
          </ion-col>
        </ion-row>
      </ion-grid>

      <ion-text color="medium" *ngIf="filteredFavorites.length === 0" class="empty-state">
        즐겨찾기한 가게가 없습니다.
      </ion-text>
    </ng-container>

    <!-- 지도 보기 -->
    <ng-container *ngIf="viewMode === 'map'">
      <ion-button fill="clear" color="medium" class="back-link" (click)="viewMode = 'list'">
        ← 목록으로 돌아가기
      </ion-button>

      <app-map-preview
        *ngIf="selectedStore"
        [lat]="selectedStore.latitude"
        [lng]="selectedStore.longitude">
      </app-map-preview>

      <div class="map-cta">
        <ion-button
          *ngIf="selectedStore"
          class="btn-primary"
          [routerLink]="['/stores', selectedStore.store_id]"
          routerDirection="forward">
          가게 상세 페이지로 이동
        </ion-button>
      </div>
    </ng-container>

  </div>
</ion-content>
