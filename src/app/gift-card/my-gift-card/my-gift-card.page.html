<app-header-bar></app-header-bar>
<app-divider></app-divider>

<app-container>
  <main class="page-body">
    <div #carousel class="carousel">
      <article #cardRef class="gift-card" *ngFor="let p of visiblePockets; let i = index; trackBy: trackByPocket"
        aria-label="gift card">
        <div class="counter" *ngIf="showCounter && i === currentIndex">
          {{ displayIndex }}
        </div>

        <!-- âœ… ì´ë¯¸ì§€ ë°•ìŠ¤ -->
        <figure class="image-box" [class.placeholder]="!getCardImage(p)">
          <img *ngIf="getCardImage(p); else noImageTpl" [src]="getCardImage(p)!" [alt]="p.giftCard?.name || 'ê¸°í”„íŠ¸ì¹´ë“œ'"
            loading="lazy" decoding="async" (error)="onImgError($event)" />
        </figure>
        <ng-template #noImageTpl>
          <div class="image-fallback">
            <span class="emoji">ğŸ</span>
            <span class="text">ì´ë¯¸ì§€ ì—†ìŒ</span>
          </div>
        </ng-template>

        <div class="info">
          <div class="title">{{ p.giftCard.name }}</div>

          <div class="meta" *ngIf="p.giftCard.type === 'EXCHANGE'">
            <span class="label">ìƒí’ˆ</span>
            <span class="value">{{ p.giftCard.name || 'ìƒí’ˆê¶Œ' }}</span>
          </div>

          <div class="meta" *ngIf="p.giftCard.type === 'AMOUNT'">
            <span class="label">ì”ì•¡</span>
            <span class="value">{{ formatKRW(p.remaining_amount) }}</span>
          </div>
        </div>

        <div class="barcode-box">ë°”ì½”ë“œ</div>
      </article>
    </div>

    <div class="empty" *ngIf="totalCount === 0">
      ì‚¬ìš© ê°€ëŠ¥í•œ ìƒí’ˆê¶Œì´ ì—†ìŠµë‹ˆë‹¤.
    </div>

    <!-- í•˜ë‹¨ ê³ ì •: ìƒˆë¡œê³ ì¹¨ ë²„íŠ¼ -->
    <div class="refresh-wrap">
      <button class="refresh-btn" (click)="onRefresh()">ìƒˆë¡œê³ ì¹¨</button>
    </div>
  </main>
</app-container>