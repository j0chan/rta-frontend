<app-header-bar></app-header-bar>
<app-divider></app-divider>

<app-container>
  <main class="page-body">
    <div #carousel class="carousel">
      <article #cardRef class="gift-card" *ngFor="let p of visiblePockets; let i = index; trackBy: trackByPocket"
        aria-label="gift card">
        <div class="counter" *ngIf="showCounter && i === currentIndex">
          {{ displayIndex }}
        </div>

        <!-- ✅ 이미지 박스 -->
        <figure class="image-box" [class.placeholder]="!getCardImage(p)">
          <img *ngIf="getCardImage(p); else noImageTpl" [src]="getCardImage(p)!" [alt]="p.giftCard?.name || '기프트카드'"
            loading="lazy" decoding="async" (error)="onImgError($event)" />
        </figure>
        <ng-template #noImageTpl>
          <div class="image-fallback">
            <span class="emoji">🎁</span>
            <span class="text">이미지 없음</span>
          </div>
        </ng-template>

        <div class="info">
          <div class="title">{{ p.giftCard.name }}</div>

          <div class="meta" *ngIf="p.giftCard.type === 'EXCHANGE'">
            <span class="label">상품</span>
            <span class="value">{{ p.giftCard.name || '상품권' }}</span>
          </div>

          <div class="meta" *ngIf="p.giftCard.type === 'AMOUNT'">
            <span class="label">잔액</span>
            <span class="value">{{ formatKRW(p.remaining_amount) }}</span>
          </div>
        </div>

        <div class="barcode-box">바코드</div>
      </article>
    </div>

    <div class="empty" *ngIf="totalCount === 0">
      사용 가능한 상품권이 없습니다.
    </div>

    <!-- 하단 고정: 새로고침 버튼 -->
    <div class="refresh-wrap">
      <button class="refresh-btn" (click)="onRefresh()">새로고침</button>
    </div>
  </main>
</app-container>