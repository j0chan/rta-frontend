<app-header-bar></app-header-bar>
<app-divider></app-divider>

<app-container>
    <section class="section promo-section" *ngIf="promos.length">
        <div class="promo-touch" (pointerdown)="onPromoPointerDown($event)" (pointerup)="onPromoPointerUp($event)"
            (pointercancel)="onPromoPointerCancel()" (touchstart)="onPromoTouchStart($event)"
            (touchend)="onPromoTouchEnd($event)" (mousedown)="onPromoMouseDown($event)"
            (mouseup)="onPromoMouseUp($event)" (mouseleave)="onPromoMouseLeave()"
            (contextmenu)="$event.preventDefault()">
            <app-promo-banner [promotion]="promos[promoIndex]" [index]="promoIndex" [total]="promos.length"
                [emphasize]="promoEmph" (clicked)="onPromoClick()">
            </app-promo-banner>
        </div>

    </section>

    <!-- 카테고리 -->
    <section class="section section-categories">
        <div class="category-bar" role="tablist" aria-label="카테고리">
            <button class="cat-chip" [class.active]="selectedCategory === c.id" *ngFor="let c of categories"
                (click)="selectCategory(c.id)" role="tab" [attr.aria-selected]="selectedCategory === c.id">
                {{ c.label }}
            </button>
        </div>
    </section>

    <!-- 로딩/에러 -->
    <section class="section" *ngIf="loading || errorMsg">
        <div class="state" *ngIf="loading">불러오는 중…</div>
        <div class="state error" *ngIf="!loading && errorMsg">{{ errorMsg }}</div>
    </section>

    <!-- 상품 리스트 (2열) -->
    <section class="section" *ngIf="!loading && !errorMsg">
        <div class="grid" *ngIf="items?.length; else emptyState">
            <article class="card item-card" *ngFor="let item of items; trackBy: trackById" (click)="goDetail(item)"
                role="button" tabindex="0">
                <div class="thumb" [class.placeholder]="!item.image_url">
                    <img *ngIf="item.image_url" [src]="item.image_url" alt="gift" (error)="onImgError($event)" />
                    <span *ngIf="!item.image_url">이미지</span>
                </div>

                <div class="body">
                    <div class="top-row">
                        <span class="brand">{{ item.brand || '브랜드' }}</span>
                        <span class="type-badge" *ngIf="item.type">
                            {{ item.type === 'EXCHANGE' ? '교환권' : '금액권' }}
                        </span>
                    </div>

                    <h3 class="title" [title]="item.name">{{ item.name }}</h3>

                    <div class="price-row">
                        <div class="price">{{ item.amount | number: '1.0-0' }}<span class="won">원</span></div>
                        <div class="cta">자세히</div>
                    </div>

                    <p class="desc" *ngIf="item.shortDesc" [title]="item.shortDesc">{{ item.shortDesc }}</p>
                </div>
            </article>
        </div>

        <ng-template #emptyState>
            <div class="empty">조건에 맞는 상품권이 없습니다.</div>
        </ng-template>
    </section>

    <div class="safe-bottom-space"></div>
</app-container>